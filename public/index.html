<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bitdealer Tweet Monitor</title>
<style>
  body { font-family: Arial; padding:20px; max-width:900px; margin:auto; }
  .tweet { border:1px solid #ddd; padding:10px; margin-bottom:10px; border-radius:6px; }
  .meta { color:#666; font-size:12px; margin-bottom:6px; }
  .metrics { font-size:12px; color:#333; margin-top:8px; }
  #status { margin-bottom:10px; color:#007700; }
</style>
</head>
<body>
<h1>Tweets mentioning @bitdealernet</h1>
<div id="status">Loading‚Ä¶</div>
<div id="tweets"></div>

<script>
async function loadTweets() {
  const statusEl = document.getElementById('status');
  statusEl.textContent = 'Fetching tweets‚Ä¶';
  try {
    const res = await fetch('/api/tweets?max_results=20'); 
    if(!res.ok) throw new Error(`Status ${res.status}`);
    const data = await res.json();
    const container = document.getElementById('tweets');
    container.innerHTML = '';

    if(!data.data || data.data.length === 0) {
      container.innerHTML = '<p>No tweets found.</p>';
      statusEl.textContent = 'No tweets';
      return;
    }

    data.data.forEach(t => {
      const el = document.createElement('div');
      el.className = 'tweet';
      const time = new Date(t.created_at).toLocaleString();
      el.innerHTML = `
        <div class="meta">Author ID: ${t.author_id} ‚Ä¢ ${time}</div>
        <div class="text">${escapeHtml(t.text)}</div>
        <div class="metrics">‚ù§Ô∏è ${t.public_metrics.like_count}  üîÅ ${t.public_metrics.retweet_count}  üí¨ ${t.public_metrics.reply_count}</div>
      `;
      container.appendChild(el);
    });

    statusEl.textContent = `Loaded ${data.data.length} tweets ‚Äî last updated ${new Date().toLocaleTimeString()}`;
  } catch(err) {
    console.error(err);
    statusEl.textContent = 'Error fetching tweets ‚Äî check server console.';
    document.getElementById('tweets').innerHTML = `<pre>${escapeHtml(String(err))}</pre>`;
  }
}

// HTML escape helper
function escapeHtml(s) {
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

loadTweets();
setInterval(loadTweets, 30000);
</script>
</body>
</html>
